<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Stylique - AI Style Transfer</title>
  <link rel="icon" type="image/png" href="{{ url_for('static', filename='favicon.png') }}">
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@500;700&display=swap" rel="stylesheet">
  <!-- Custom CSS -->
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg fixed-top"> <!-- Added fixed-top -->
    <div class="container-fluid">
      <a class="navbar-brand" href="#"> <!-- Changed href to # -->
        <img src="{{ url_for('static', filename='logo.png') }}" alt="Stylique Logo">
      </a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav ms-auto">
          <li class="nav-item"><a class="nav-link" href="#upload-section">Upload</a></li>
          <li class="nav-item"><a class="nav-link" href="#gallery-section">Gallery</a></li>
        </ul>
      </div>
    </div>
  </nav>

  <!-- Header Section (Upload Form) -->
  <section class="header-bar" id="upload-section">
    <div class="container"> <!-- Added container for better layout -->
        <div class="row align-items-center justify-content-center">
            <div class="col-lg-6 header-text">
              <h1>Style Your Image</h1>
              <p class="lead mb-4">Upload your content image, choose a style, and let AI transform it!</p>

              <!-- Flash Messages -->
              {% with messages = get_flashed_messages(with_categories=true) %}
                {% if messages %}
                  {% for category, message in messages %}
                  <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
                    {{ message }}
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                  </div>
                  {% endfor %}
                {% endif %}
              {% endwith %}

              <!-- Upload Form -->
              <div class="upload-box">
                <form id="stylizeForm" method="POST" action="{{ url_for('stylize') }}" enctype="multipart/form-data">
                  <!-- Hidden field for style_mode, set by JS -->
                  <input type="hidden" name="style_mode" id="style_mode_input" value="predefined">

                  <!-- Content Image Upload -->
                  <div class="mb-3">
                    <label for="content_file" class="form-label">1. Upload Content Image:</label>
                    <input type="file" name="content_file" id="content_file" class="form-control" accept="image/png, image/jpeg, image/jpg, image/webp" required>
                  </div>

                  <!-- Style Selection Mode -->
                  <div class="mb-3">
                     <label class="form-label">2. Choose Style Source:</label><br>
                     <div class="form-check form-check-inline">
                        <input class="form-check-input" type="radio" name="style_choice_trigger" id="style_predefined_trigger" value="predefined" checked onchange="toggleStyleInput()">
                        <label class="form-check-label" for="style_predefined_trigger">Use Predefined Style</label>
                     </div>
                     <div class="form-check form-check-inline">
                        <input class="form-check-input" type="radio" name="style_choice_trigger" id="style_custom_trigger" value="custom" onchange="toggleStyleInput()">
                        <label class="form-check-label" for="style_custom_trigger">Upload Custom Style</label>
                     </div>
                     {% if show_example_button %}
                     <div class="form-check form-check-inline">
                        <input class="form-check-input" type="radio" name="style_choice_trigger" id="style_example_trigger" value="example" onchange="toggleStyleInput()">
                        <label class="form-check-label" for="style_example_trigger">Use Example</label>
                      </div>
                     {% endif %}
                  </div>

                  <!-- Predefined Style Input -->
                  <div class="mb-3" id="predefined_style_section">
                    <label for="predefined_style_name" class="form-label">Select Predefined Style:</label>
                    <select name="predefined_style_name" id="predefined_style_name" class="form-select">
                      <option value="" disabled selected>Choose a style...</option>
                      {% for style_file in predefined_styles %}
                        <option value="{{ style_file }}">{{ style_file.rsplit('.', 1)[0]|replace('_', ' ')|title }}</option>
                      {% else %}
                        <option value="" disabled>No predefined styles found.</option>
                      {% endfor %}
                    </select>
                  </div>

                  <!-- Custom Style Input (Initially Hidden) -->
                  <div class="mb-3 visually-hidden" id="custom_style_section"> <!-- Use visually-hidden for better accessibility -->
                    <label for="custom_style_file" class="form-label">Upload Custom Style Image:</label>
                    <input type="file" name="custom_style_file" id="custom_style_file" class="form-control" accept="image/png, image/jpeg, image/jpg, image/webp">
                  </div>

                  <!-- Example Info (Initially Hidden) -->
                  <div class="mb-3 visually-hidden" id="example_style_section">
                    <p class="text-muted">
                        Using example images: <br>
                        Content: <strong>{{ example_content_name }}</strong> <br>
                        Style: <strong>{{ example_style_name }}</strong>
                    </p>
                    <!-- No input needed here, style_mode='example' handles it -->
                  </div>


                  <!-- Iteration Controls -->
                  <div class="mb-3 row">
                    <div class="col-md-6">
                        <label for="teacher_iterations" class="form-label">Teacher Iterations:</label>
                        <input type="number" name="teacher_iterations" id="teacher_iterations" class="form-control iteration-input" value="50" min="1" max="500">
                        <small class="form-text text-muted d-block">(Slow, High Quality)</small> <!-- Added d-block -->
                    </div>
                     <div class="col-md-6">
                        <label for="student_iterations" class="form-label">Student Iterations:</label>
                        <input type="number" name="student_iterations" id="student_iterations" class="form-control iteration-input" value="1" min="1" max="10">
                         <small class="form-text text-muted d-block">(Fast, Pre-trained Style)</small> <!-- Added d-block -->
                    </div>
                  </div>

                  <button type="submit" class="btn btn-primary w-100 mt-3">Stylize Image</button>
                </form>
              </div>
            </div><!-- /col-lg-6 -->

            <div class="col-lg-5 text-center mt-4 mt-lg-0"> <!-- Adjusted column size -->
              <!-- Example Stylized Image -->
               <img src="{{ url_for('static', filename='example.png') }}" alt="Example stylized output" class="example-image img-fluid">
            </div>
        </div> <!-- /row -->
    </div> <!-- /container -->
  </section>

  <!-- Style Gallery Section -->
  <section class="style-gallery" id="gallery-section">
      <div class="container"> <!-- Added container -->
          <h2>Discover Our <span class="cinzel">Styliques</span></h2>
          <div class="style-gallery-content">
              <button class="nav-arrow prev" onclick="showPreviousSlide()">❮</button>
              <div id="carousel" class="flex-grow-1">
                  <!-- Carousel content generated by JS -->
                  <div class="text-center p-5"><span class="spinner-border text-light"></span> Loading styles...</div>
              </div>
              <button class="nav-arrow next" onclick="showNextSlide()">❯</button>
          </div>
      </div> <!-- /container -->
  </section>

  <!-- Footer -->
  <footer>
    <div class="container"> <!-- Added container -->
      <img src="{{ url_for('static', filename='logo.png') }}" alt="Stylique Logo Small">
      <p>© {% now 'local', '%Y' %} Stylique. All Rights Reserved.</p> <!-- Dynamic year -->
    </div>
  </footer>

  <!-- Bootstrap JS Bundle -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <!-- Custom JS -->
  <script>
    // --- Style Input Toggle ---
    function toggleStyleInput() {
      const predefinedSection = document.getElementById('predefined_style_section');
      const customSection = document.getElementById('custom_style_section');
      const exampleSection = document.getElementById('example_style_section');

      const predefinedRadio = document.getElementById('style_predefined_trigger');
      const customRadio = document.getElementById('style_custom_trigger');
      const exampleRadio = document.getElementById('style_example_trigger'); // Get example radio

      const customStyleInput = document.getElementById('custom_style_file');
      const predefinedStyleSelect = document.getElementById('predefined_style_name');
      const contentInput = document.getElementById('content_file');
      const styleModeHiddenInput = document.getElementById('style_mode_input');

      // Reset all sections and requirements first
      predefinedSection.classList.add('visually-hidden');
      customSection.classList.add('visually-hidden');
      exampleSection.classList.add('visually-hidden'); // Hide example section
      customStyleInput.required = false;
      predefinedStyleSelect.required = false;
      contentInput.required = true; // Content always required unless example mode

      // Enable sections based on selected radio
      if (predefinedRadio && predefinedRadio.checked) {
        predefinedSection.classList.remove('visually-hidden');
        predefinedStyleSelect.required = true;
        styleModeHiddenInput.value = 'predefined';
      } else if (customRadio && customRadio.checked) {
        customSection.classList.remove('visually-hidden');
        customStyleInput.required = true;
        styleModeHiddenInput.value = 'custom';
      } else if (exampleRadio && exampleRadio.checked) {
        exampleSection.classList.remove('visually-hidden');
        contentInput.required = false; // Content upload not needed for example
        styleModeHiddenInput.value = 'example';
        // Clear any selected files to avoid confusion
        contentInput.value = '';
        customStyleInput.value = '';
        predefinedStyleSelect.value = '';

      }
    }

    // Initialize on page load
    document.addEventListener('DOMContentLoaded', toggleStyleInput);


    // --- Style Gallery Carousel ---
    let currentSlide = 0;
    // Use url_for to generate image paths robustly
    const styles = [
      { name: "Mosaic Style", descLeft: "Ancient Art / Byzantine / Romanesque", image: "{{ url_for('static', filename='styles/mosaic.jpg') }}", descRight: "A technique using small pieces (tesserae) to create images, popular across many ancient civilizations." },
      { name: "Mona Lisa Style", descLeft: "Leonardo da Vinci (c. 1503–06). High Renaissance.", image: "{{ url_for('static', filename='styles/monalisa.jpg') }}", descRight: "Famous for sfumato (soft transitions) and enigmatic expression." },
      { name: "Starry Night Style", descLeft: "Vincent van Gogh (1889). Post-Impressionism.", image: "{{ url_for('static', filename='styles/night.jpg') }}", descRight: "Characterized by expressive brushwork, emotional intensity, and vivid, swirling colors." },
      { name: "The Great Wave", descLeft: "Katsushika Hokusai (c. 1831). Ukiyo-e woodblock print.", image: "{{ url_for('static', filename='styles/wave.jpg') }}", descRight: "Iconic Japanese art depicting nature's power and Mount Fuji. Part of 'Thirty-six Views of Mount Fuji'." },
      // Add more styles here if they exist in static/styles
      // { name: "Pixel Art Style", descLeft: "Digital Art / Retro Gaming", image: "{{ url_for('static', filename='styles/Pixel.png') }}", descRight: "Style defined by low-resolution graphics where individual pixels are visible." },

    ];

    function renderSlide() {
      const container = document.getElementById('carousel');
      if (!container || styles.length === 0) {
          if(container) container.innerHTML = '<div class="text-center p-5 text-light">No styles available to display.</div>';
          return;
      }
      const style = styles[currentSlide];
      const frameImage = "{{ url_for('static', filename='frame.jpg') }}"; // Cache frame URL

      // Determine orientation class (simple check based on common aspect ratios)
      // This requires knowing image dimensions beforehand or loading them async.
      // For simplicity, we'll omit dynamic orientation for now. Add JS image loading if needed.
      // const orientationClass = style.isLandscape ? 'landscape' : ''; // Example

      container.innerHTML = `
        <div class="style-item">
          <div class="style-row">
            <div class="style-desc">${style.descLeft || 'N/A'}</div>
            <div class="frame-container">
              <img src="${frameImage}" class="frame-background" alt="Ornate Frame">
              <img src="${style.image}" class="framed-style" alt="${style.name}" loading="lazy">
            </div>
            <div class="style-desc">${style.descRight || 'N/A'}</div>
          </div>
          <span class="style-text">${style.name}</span>
        </div>
      `;
    }

    function showPreviousSlide() {
      if (styles.length === 0) return;
      currentSlide = (currentSlide - 1 + styles.length) % styles.length;
      renderSlide();
    }

    function showNextSlide() {
      if (styles.length === 0) return;
      currentSlide = (currentSlide + 1) % styles.length;
      renderSlide();
    }

    // Initial render when the gallery is ready
    document.addEventListener('DOMContentLoaded', renderSlide);

  </script>
</body>
</html>